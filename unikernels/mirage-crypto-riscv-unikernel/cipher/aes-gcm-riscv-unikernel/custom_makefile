# Generated by ./config.exe config -t riscv (2021-03-31 01:50:42-00:00).

-include Makefile.user

OPAM = opam
DEPEXT ?= $(OPAM) pin add -k path --no-action --yes mirage-unikernel-secure_shakti_voting-riscv . &&\
	$(OPAM) depext --yes --update mirage-unikernel-secure_shakti_voting-riscv ;\
	$(OPAM) pin remove --no-action mirage-unikernel-secure_shakti_voting-riscv

.PHONY: all depend depends clean build
all:: build

depend depends::
	$(DEPEXT)
	$(OPAM) install -y --deps-only .

build::
	mirage build

clean::
	mirage clean


OCAML_FREESTANDING_RISCV_PATH := $(shell opam exec --  ocamlfind -toolchain riscv query ocaml-freestanding-riscv)
MIRAGE_RISCV_BINDINGS_PATH = $(shell opam exec -- ocamlfind -toolchain riscv query mirage-riscv)
LINKER_PATH = "/home/sai/Shakti-TEE-Practical/mirage-shakti/auto-linker-generator/gmp_reverse_engineering"
BOOT_PATH := $(shell opam exec --  ocamlfind -toolchain riscv query ocaml-boot-riscv)
#GMP_PATH := $(shell opam exec -- ocamlfind -toolchain riscv query gmp-freestanding-riscv)
#ZARITH_PATH := $(shell opam exec -- ocamlfind -toolchain riscv query zarith)
CRYPTO_PATH := $(shell opam exec -- ocamlfind -toolchain riscv query mirage-crypto)

kernel::
	riscv64-unknown-elf-g++  -mcmodel=medany _build/main.native.o -o kernel -static -nostdlib -nostartfiles -Wl,-L$(LINKER_PATH) -Wl,-T$(LINKER_PATH)/linker.x -Wl,--start-group $(OCAML_FREESTANDING_RISCV_PATH)/libnolibc.a $(BOOT_PATH)/libboot.a $(OCAML_FREESTANDING_RISCV_PATH)/libasmrun.a $(MIRAGE_RISCV_BINDINGS_PATH)/libmirage-riscv_bindings.a $(CRYPTO_PATH)/libmirage_crypto_freestanding_stubs.a -Wl,--end-group -lm -lgcc

